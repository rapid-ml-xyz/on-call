"""Time series window analysis cell.
Calculates time windows for analysis and runs performance reports across specified windows.
Configures column mapping for target, prediction, and feature variables."""

from on_call.modules.time_series_reports import (
   calculate_dynamic_window_info,
   generate_time_windows_datetime,
   run_performance_reports
)

{% raw %}
---CELL---
{% endraw %}
"""Calculate time windows dynamically based on current data"""

n_windows, actual_window_timeframe = calculate_dynamic_window_info(current)
print(f"Number of windows: {n_windows}")
print(f"Window timeframe: {actual_window_timeframe}")

{% raw %}
---CELL---
{% endraw %}
"""Generate and display time window intervals"""

windows = generate_time_windows_datetime(current)
for start_time, end_time in windows:
    print(f"Window: {start_time} to {end_time}")
    window_data = reference.loc[start_time:end_time]

{% raw %}
---CELL---
{% endraw %}
"""Configure column mapping and run performance analysis"""

column_mapping = ColumnMapping()
column_mapping.target = {{ target }}
column_mapping.prediction = {{ prediction }}
column_mapping.numerical_features = {{ numerical_features }}
column_mapping.categorical_features = {{ categorical_features }}

reports = run_performance_reports(
    current=current,
    reference=reference,
    column_mapping=column_mapping)
